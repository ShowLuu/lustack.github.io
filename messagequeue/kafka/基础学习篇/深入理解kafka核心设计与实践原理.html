<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、基本概念 | lustack 知识星球</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="沉淀、分享、成长">
    
    <link rel="preload" href="/lustack.github.io/assets/css/0.styles.cd78999c.css" as="style"><link rel="preload" href="/lustack.github.io/assets/js/app.66f88025.js" as="script"><link rel="preload" href="/lustack.github.io/assets/js/2.be206077.js" as="script"><link rel="preload" href="/lustack.github.io/assets/js/10.10d7d04b.js" as="script"><link rel="prefetch" href="/lustack.github.io/assets/js/11.487a6640.js"><link rel="prefetch" href="/lustack.github.io/assets/js/12.8d03ef92.js"><link rel="prefetch" href="/lustack.github.io/assets/js/13.1cade734.js"><link rel="prefetch" href="/lustack.github.io/assets/js/14.e452857b.js"><link rel="prefetch" href="/lustack.github.io/assets/js/15.30ecd203.js"><link rel="prefetch" href="/lustack.github.io/assets/js/16.8d1be629.js"><link rel="prefetch" href="/lustack.github.io/assets/js/17.f0cb870f.js"><link rel="prefetch" href="/lustack.github.io/assets/js/18.cf840a09.js"><link rel="prefetch" href="/lustack.github.io/assets/js/19.cd52d169.js"><link rel="prefetch" href="/lustack.github.io/assets/js/20.987b23a0.js"><link rel="prefetch" href="/lustack.github.io/assets/js/21.390f06a0.js"><link rel="prefetch" href="/lustack.github.io/assets/js/22.a8716fe4.js"><link rel="prefetch" href="/lustack.github.io/assets/js/23.dbc1e4be.js"><link rel="prefetch" href="/lustack.github.io/assets/js/3.6b3e1575.js"><link rel="prefetch" href="/lustack.github.io/assets/js/4.032b12d5.js"><link rel="prefetch" href="/lustack.github.io/assets/js/5.9d5a42da.js"><link rel="prefetch" href="/lustack.github.io/assets/js/6.fe70bd28.js"><link rel="prefetch" href="/lustack.github.io/assets/js/7.0a429ad2.js"><link rel="prefetch" href="/lustack.github.io/assets/js/8.ba983ee5.js"><link rel="prefetch" href="/lustack.github.io/assets/js/9.7bc7b9b9.js">
    <link rel="stylesheet" href="/lustack.github.io/assets/css/0.styles.cd78999c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lustack.github.io/" class="home-link router-link-active"><img src="/lustack.github.io/assets/img/logo.jpg" alt="lustack 知识星球" class="logo"> <span class="site-name can-hide">lustack 知识星球</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目管理" class="dropdown-title"><span class="title">项目管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目管理" class="mobile-dropdown-title"><span class="title">项目管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          版本控制工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/pm/git/Gitee.html" class="nav-link">
  Git第一章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="操作系统" class="mobile-dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Linux基本操作
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/opsystem/linux/01/01.html" class="nav-link">
  第一章
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/opsystem/linux/02.html" class="nav-link">
  第二章
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/opsystem/linux/shell/01.html" class="nav-link">
  第三章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Netty" class="dropdown-title"><span class="title">Netty</span> <span class="arrow down"></span></button> <button type="button" aria-label="Netty" class="mobile-dropdown-title"><span class="title">Netty</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lustack.github.io/netty/Netty学习笔记.html" class="nav-link">
  基础篇(一)
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/java/设计模式/重学设计模式.html" class="nav-link">
  重学设计模式
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息队列" class="dropdown-title"><span class="title">消息队列</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息队列" class="mobile-dropdown-title"><span class="title">消息队列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          kafka
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/messagequeue/kafka/基础学习篇/基础学习篇.html" class="nav-link">
  基础篇
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/messagequeue/kafka/基础学习篇/深入理解kafka核心设计与实践原理.html" class="nav-link">
  深入理解kafka核心设计与实践原理
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          elasticsearch
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/Logstash.html" class="nav-link">
  elk
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/base01.html" class="nav-link">
  基础篇(一)
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/base02.html" class="nav-link">
  基础篇(二)
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/skill01.html" class="nav-link">
  碎片篇(一)
</a></li></ul></li><li class="dropdown-item"><h4>
          mongodb
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/mongodb/ChangeStareamDemo.html" class="nav-link">
  ChangeStream.1
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/mongodb/MongodbChangeStareamDemo.html" class="nav-link">
  ChangeStream.2
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="表单工作流" class="dropdown-title"><span class="title">表单工作流</span> <span class="arrow down"></span></button> <button type="button" aria-label="表单工作流" class="mobile-dropdown-title"><span class="title">表单工作流</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          轻量级turbo
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/formworkflow/turbo/think.html" class="nav-link">
  推荐
</a></li></ul></li><li class="dropdown-item"><h4>
          flowable
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/formworkflow/yudao/think.html" class="nav-link">
  芋道源码
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/ShowLuu/lu-stack-maven-repository" target="_blank" rel="noopener noreferrer" class="nav-link external">
  组件私服
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://gitee.com/Showluu" target="_blank" rel="noopener noreferrer" class="repo-link">
    源码仓库
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目管理" class="dropdown-title"><span class="title">项目管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="项目管理" class="mobile-dropdown-title"><span class="title">项目管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          版本控制工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/pm/git/Gitee.html" class="nav-link">
  Git第一章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="操作系统" class="dropdown-title"><span class="title">操作系统</span> <span class="arrow down"></span></button> <button type="button" aria-label="操作系统" class="mobile-dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Linux基本操作
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/opsystem/linux/01/01.html" class="nav-link">
  第一章
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/opsystem/linux/02.html" class="nav-link">
  第二章
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/opsystem/linux/shell/01.html" class="nav-link">
  第三章
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Netty" class="dropdown-title"><span class="title">Netty</span> <span class="arrow down"></span></button> <button type="button" aria-label="Netty" class="mobile-dropdown-title"><span class="title">Netty</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lustack.github.io/netty/Netty学习笔记.html" class="nav-link">
  基础篇(一)
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java基础" class="dropdown-title"><span class="title">Java基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java基础" class="mobile-dropdown-title"><span class="title">Java基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          设计模式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/java/设计模式/重学设计模式.html" class="nav-link">
  重学设计模式
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="消息队列" class="dropdown-title"><span class="title">消息队列</span> <span class="arrow down"></span></button> <button type="button" aria-label="消息队列" class="mobile-dropdown-title"><span class="title">消息队列</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          kafka
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/messagequeue/kafka/基础学习篇/基础学习篇.html" class="nav-link">
  基础篇
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/messagequeue/kafka/基础学习篇/深入理解kafka核心设计与实践原理.html" class="nav-link">
  深入理解kafka核心设计与实践原理
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          elasticsearch
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/Logstash.html" class="nav-link">
  elk
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/base01.html" class="nav-link">
  基础篇(一)
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/base02.html" class="nav-link">
  基础篇(二)
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/elasticsearch/skill01.html" class="nav-link">
  碎片篇(一)
</a></li></ul></li><li class="dropdown-item"><h4>
          mongodb
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/mongodb/ChangeStareamDemo.html" class="nav-link">
  ChangeStream.1
</a></li><li class="dropdown-subitem"><a href="/lustack.github.io/dataprocessing/mongodb/MongodbChangeStareamDemo.html" class="nav-link">
  ChangeStream.2
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="表单工作流" class="dropdown-title"><span class="title">表单工作流</span> <span class="arrow down"></span></button> <button type="button" aria-label="表单工作流" class="mobile-dropdown-title"><span class="title">表单工作流</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          轻量级turbo
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/formworkflow/turbo/think.html" class="nav-link">
  推荐
</a></li></ul></li><li class="dropdown-item"><h4>
          flowable
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/lustack.github.io/formworkflow/yudao/think.html" class="nav-link">
  芋道源码
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/ShowLuu/lu-stack-maven-repository" target="_blank" rel="noopener noreferrer" class="nav-link external">
  组件私服
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://gitee.com/Showluu" target="_blank" rel="noopener noreferrer" class="repo-link">
    源码仓库
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>一、基本概念</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#一-与主题有关的kafka-topic-sh脚本" class="sidebar-link">(一)与主题有关的Kafka-topic.sh脚本</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#二-生产消费相关脚本kafka-console-producer-sh-和-kafka-console­-consumer-sh" class="sidebar-link">(二)生产消费相关脚本kafka-console-producer.sh 和 kafka-console­ consumer. sh</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#三-与配置有关的脚本kafka-configs-sh" class="sidebar-link">(三)与配置有关的脚本kafka-configs.sh</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#四-对leader副本进行重平衡的功能kafka-preferred-replics-election-sh" class="sidebar-link">(四)对leader副本进行重平衡的功能kafka-preferred-replics-election.sh</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#五-分区重分配kafka-reassign-partitions-sh" class="sidebar-link">(五)分区重分配kafka-reassign-partitions.sh</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#六-压测脚本kafka-producer-perf-test-sh、kafka-consumer-perf-test-sh" class="sidebar-link">(六)压测脚本kafka-producer-perf-test.sh、kafka-consumer-perf-test.sh</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#七-kafka-run-class-sh" class="sidebar-link">(七)kafka-run-class.sh</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#八" class="sidebar-link">(八)</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#一-服务端参数配置" class="sidebar-link">(一)服务端参数配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#二-、客户端参数配置" class="sidebar-link">(二)、客户端参数配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#_1-生产者参数配置" class="sidebar-link">1.生产者参数配置</a></li><li class="sidebar-sub-header"><a href="/lustack.github.io/messagequeue/kafka/%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3kafka%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E8%B7%B5%E5%8E%9F%E7%90%86.html#_3-消费者参数配置" class="sidebar-link">3.消费者参数配置</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一、基本概念"><a href="#一、基本概念" class="header-anchor">#</a> 一、基本概念</h1> <p>AR=ISR+OSR</p> <p>AR，所有副本</p> <p>ISR，与leader保持一定的同步速度的副本</p> <p>OSR，与leader同步停滞过多的副本</p> <p>HW，消费者下一次拉取消息的最大offset</p> <p>LEO(Log End Offset)，消息写入日志的下一次的位置</p> <p>LSO(LastStableOffset)，生产者提交事务的最后位置。isolation.level，read_uncommitted读到未提交的，此时lso=hw；read_committed读生产者已经提交的</p> <p>LSO≤HW≤LEO</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>后台启动，并将pid记录日志
<span class="token function">nohup</span> ./bin/kafka-server-start.sh config/server.properties <span class="token operator">&amp;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$!</span> <span class="token operator">&gt;</span> pid.txt

杀死服务
<span class="token function">kill</span> <span class="token parameter variable">-9</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> pid.txt<span class="token variable">`</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="二、常见命令"><a href="#二、常见命令" class="header-anchor">#</a> 二、常见命令</h1> <h2 id="一-与主题有关的kafka-topic-sh脚本"><a href="#一-与主题有关的kafka-topic-sh脚本" class="header-anchor">#</a> (一)与主题有关的Kafka-topic.sh脚本</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>查看主题
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--list</span>

创建主题<span class="token punctuation">(</span>自动分配分区副本<span class="token punctuation">)</span>
bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181/kafka <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> topic-demo --replication-factor <span class="token number">3</span> <span class="token parameter variable">--partitions</span> <span class="token number">4</span>

创建主题<span class="token punctuation">(</span>自定义分配分区副本<span class="token punctuation">)</span>
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> lu-learn --replica-assignment <span class="token number">0</span>:1:2,1:2:0,2:0:1

创建主题<span class="token punctuation">(</span>带上配置<span class="token punctuation">)</span>
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> lu-learn --replica-assignment <span class="token number">0</span>:1:2,1:2:0,2:0:1 <span class="token parameter variable">--config</span> <span class="token assign-left variable">max.message.bytes</span><span class="token operator">=</span><span class="token number">10000</span> <span class="token parameter variable">--config</span> <span class="token assign-left variable">cleanup.policy</span><span class="token operator">=</span>compact

展示主题分区副本信息
bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181/kafka <span class="token parameter variable">--describe</span> <span class="token parameter variable">--topic</span> topic-demo

找出使用了config额外配置的主题
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--describe</span> --topics-with-overrides

找出所有包含失效副本的分区<span class="token punctuation">(</span>ISR<span class="token operator">&lt;</span>AR，即OSR存在分区<span class="token punctuation">)</span>
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--describe</span> --under-replicated-partitions

找出问题的分区
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--describe</span> --unavailable-partitions

删除主题
bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--delete</span> <span class="token parameter variable">--topic</span> lu-learn

修改主题<span class="token punctuation">(</span>修改分区数，只能增不能减<span class="token punctuation">)</span>
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> lu-learn <span class="token parameter variable">--partitions</span> <span class="token number">4</span>

修改主题配置
./bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> lu-learn <span class="token parameter variable">--config</span> <span class="token assign-left variable">segment.bytes</span><span class="token operator">=</span><span class="token number">1048577</span>

删除主题配置
/bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> lu-learn --delete-config segment.bytes

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="二-生产消费相关脚本kafka-console-producer-sh-和-kafka-console­-consumer-sh"><a href="#二-生产消费相关脚本kafka-console-producer-sh-和-kafka-console­-consumer-sh" class="header-anchor">#</a> (二)生产消费相关脚本kafka-console-producer.sh 和 kafka-console­ consumer. sh</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>消费者订阅主题
bin/kafka.console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> topic-demo

生产者生产消息
bin/kafka.console-producer.sh --broker-list losthost:9092 <span class="token parameter variable">--topic</span> topic-demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="三-与配置有关的脚本kafka-configs-sh"><a href="#三-与配置有关的脚本kafka-configs-sh" class="header-anchor">#</a> (三)与配置有关的脚本kafka-configs.sh</h2> <ul><li><p>支持两类：变更配置alter、查看配置describe</p></li> <li><p>查看配置describe</p> <ul><li>模版：bin/kafka-configs.sh --zookeeper 127.0.0.1:2181 --describe --entity-type xxx entity-name xxx
<ul><li>entity-type：topics、brokers、clients、users</li> <li><img src="/lustack.github.io/assets/img/6.b49f9985.png" alt="image-20201108171043478"></li></ul></li></ul></li> <li><p>变更配置alter</p> <ul><li>add-config：增改</li> <li>delete-config：删</li></ul></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./bin/kafka-configs.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 

./bin/kafka-configs.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--alter</span> --entity-type topics --entity-name lu-learn --add-config <span class="token assign-left variable">max.message.bytes</span><span class="token operator">=</span><span class="token number">10001</span> 

./bin/kafka-configs.sh <span class="token parameter variable">--zookeeper</span> <span class="token number">127.0</span>.0.1:2181 <span class="token parameter variable">--alter</span> --entity-type topics --entity-name lu-learn --delete-config max.message.bytes
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="四-对leader副本进行重平衡的功能kafka-preferred-replics-election-sh"><a href="#四-对leader副本进行重平衡的功能kafka-preferred-replics-election-sh" class="header-anchor">#</a> (四)对leader副本进行重平衡的功能kafka-preferred-replics-election.sh</h2> <ul><li><p>再平衡，就是通过zk重新选举，把当前分区的优先副本选举为leader副本.</p> <ul><li>可以配置broker的再平衡策略，例如是否需要开启再平衡机制，开启再平衡机制，多久检测一次？因为再平衡操作，主要是为了让整个集群负载均衡，且再平衡时，为了保证安全性，所有其他等操作都会暂时停止，对于高并发吞吐的场景，可能会造成丢消息等情况，例如再平衡出发，手动提交偏移量没有执行提交。所以这个策略是情况而定，一般建议手动执行脚本出发。集群负载不均衡也是可用，不用一味的发现需要再平衡的情况就立马执行再平衡，通常也需要一个阈值判断。也需要考虑每个服务器的硬件环境。</li></ul></li> <li><p>对所有主题分区进行重平衡：./bin/kafka-preferred-replica-election.sh --zookeeper localhost:2181</p></li> <li><p>指定主题分区进行重平衡：./bin/kafka-preferred-replica-election.sh --zookeeper localhost:2181 --path-to-json-file preferred-replica-election-json.txt</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>preferred-replica-election-json.txt文件内容
<span class="token punctuation">{</span>
   <span class="token property">&quot;partitions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span>
       <span class="token punctuation">{</span>
           <span class="token property">&quot;partition&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
           <span class="token property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lu-learn&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">{</span>
           <span class="token property">&quot;partition&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
           <span class="token property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lu-learn&quot;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
           <span class="token property">&quot;partition&quot;</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
           <span class="token property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lu-learn&quot;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">]</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul> <h2 id="五-分区重分配kafka-reassign-partitions-sh"><a href="#五-分区重分配kafka-reassign-partitions-sh" class="header-anchor">#</a> (五)分区重分配kafka-reassign-partitions.sh</h2> <ul><li><p>原理</p> <ul><li>数据复制：现增加新的副本，然后进行数据同步，最后删除旧的副本。</li></ul></li> <li><p>应用场景：</p> <ul><li>当需要对集群中的某一个节点下线时，为了保证分区及副本的合理分配，可以通过此脚本将该节点上的分区副本迁移到其他的可用节点上。</li> <li>当集群中新增broker节点时，只有新创建的主题分区才有肯呢个分配到那个新增的节点上，而之前的主题分区则不会自动分配加入到新的节点上，此时就需要分区的冲分配机制了。</li></ul></li> <li><p>步骤：</p> <ul><li><p>创建一个json文件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;topics&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;topic&quot;</span><span class="token operator">:</span> <span class="token string">&quot;lu-test&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>根据该json指定所要分配的broker节点列表来生成一份重分配的方案</p> <ul><li><p>执行命令：./bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --generate --topics-to-move-json-file reassign-partitions-json.txt --broker-list 0,2</p></li> <li><p>得到服务器端返回json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>Current partition replica assignment
<span class="token punctuation">{</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;partitions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>

Proposed partition reassignment configuration
<span class="token punctuation">{</span><span class="token property">&quot;version&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;partitions&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token property">&quot;topic&quot;</span><span class="token operator">:</span><span class="token string">&quot;lu-test&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;partition&quot;</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">&quot;replicas&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">&quot;log_dirs&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;any&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li> <li><p>将上面第二个json保存为文件，执行命令</p> <ul><li>执行命令：./bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --execute --reassignment-json-file reassign-partitions-json-execute.txt</li> <li>验证命令：./bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --verify --reassignment-json-file reassign-partitions-json-execute.txt</li></ul></li></ul></li> <li><p>分区重分配限流</p> <ul><li>前几个步骤和上面一样</li> <li>执行命令不同，实际上就多加了一个参数配置：throttle。执行完毕，自动清除设置<code>Throttle was removed.</code> <ul><li>./bin/kafka-reassign-partitions.sh --zookeeper localhost:2181 --execute --reassignment-json-file reassign-partitions-json-execute.txt --throttle 1024</li></ul></li></ul></li></ul> <h2 id="六-压测脚本kafka-producer-perf-test-sh、kafka-consumer-perf-test-sh"><a href="#六-压测脚本kafka-producer-perf-test-sh、kafka-consumer-perf-test-sh" class="header-anchor">#</a> (六)压测脚本kafka-producer-perf-test.sh、kafka-consumer-perf-test.sh</h2> <ul><li><p>生产者压测脚本kafka-consumer-perf-test.sh</p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>执行：./bin/kafka-producer-perf-test.sh <span class="token parameter variable">--topic</span> lu-learn --num-records <span class="token number">100000</span> --record-size <span class="token number">1024</span> <span class="token parameter variable">--throughput</span> <span class="token parameter variable">-1</span> --producer-props <span class="token assign-left variable">bootstrap.servers</span><span class="token operator">=</span>localhost:9092 <span class="token assign-left variable">acks</span><span class="token operator">=</span><span class="token number">1</span>

响应：10000 records sent, <span class="token number">15649.452269</span> records/sec <span class="token punctuation">(</span><span class="token number">15.28</span> MB/sec<span class="token punctuation">)</span>, <span class="token number">205.12</span> ms avg latency, <span class="token number">321.00</span> ms max latency, <span class="token number">218</span> ms 50th, <span class="token number">310</span> ms 95th, <span class="token number">317</span> ms 99th, <span class="token number">318</span> ms <span class="token number">99</span>.9th.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>请求参数：</p> <ul><li>num-records：指定发送消息总数</li> <li>record-size：设置每条消息的字节数</li> <li>producer-props：指定生产者客户端的配置</li> <li>producer.config：指定生产者服务端的配置</li> <li>throughput：吞吐量限流控制<code>&lt;0</code>不限流</li> <li>print-mertrics：打印显示更多的指标</li></ul></li> <li><p>响应参数：</p> <ul><li>records sent：发送消息总数</li> <li>records/sec：以每秒发送的消息数来统计吞吐量，括号里面的MB/sec表示以每秒发送消息大小来统计吞吐量</li> <li>avg latency：消息处理的平均耗时</li> <li>max latency：消息处理额最大耗时</li> <li>218 ms 50th, 310 ms 95th, 317 ms 99th, 318 ms 99.9th：表示50%、95%、99%、99.9%的消息处理耗时</li></ul></li></ul></li> <li><p>消费者压测脚本kafka-consumer-perf-test.sh</p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>执行：./bin/kafka-consumer-perf-test.sh <span class="token parameter variable">--topic</span> lu-learn <span class="token parameter variable">--messages</span> <span class="token number">1000</span> --broker-list localhost:9092

响应：start.time, end.time, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec
<span class="token number">2020</span>-11-15 <span class="token number">23</span>:14:05:208, <span class="token number">2020</span>-11-15 <span class="token number">23</span>:14:05:389, <span class="token number">0.9766</span>, <span class="token number">5.3954</span>, <span class="token number">1000</span>, <span class="token number">5524.8619</span>, <span class="token number">12</span>, <span class="token number">169</span>, <span class="token number">5.7785</span>, <span class="token number">5917.1598</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>响应参数</p> <ul><li>start.time、end.time：起止运行时间</li> <li>data.consumed.in.MB：消费消息的总量，单位MB</li> <li>MB.sec：按字节大小计算的消费吞吐量，单位MB/s</li> <li>data.consumed.in.nMsg：消费的消息总数</li> <li>nMsg.sec：按个数计算的吞吐量</li> <li>rebalance.time.ms：再平衡时间，单位ms</li> <li>fetch.time.ms：拉取消息的持续时间，单位ms
<ul><li>fetch.time.ms = end.time - start.time - rebalance.time.ms</li></ul></li> <li>fetch.MB.sec：每秒拉取消息的字节大小，单位MB/s</li> <li>fetch.nMsg.sec：每秒拉取消息的个数</li></ul></li></ul></li></ul> <h2 id="七-kafka-run-class-sh"><a href="#七-kafka-run-class-sh" class="header-anchor">#</a> (七)kafka-run-class.sh</h2> <ul><li><p>日志</p> <ul><li><p>查看</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./bin/kafka-run-class.sh kafka.tools.DumpLogSegments <span class="token parameter variable">--files</span> /Users/zhanglu/Desktop/lu/tool/dev/kafka/kafka_colony/kafka_2.11-2.2.0_0/logs/lu-learn-0/00000000000000008464.log 

V0版本，一条MsgSize <span class="token operator">=</span> 12B<span class="token punctuation">(</span>日志消息头部<span class="token punctuation">)</span>+14B<span class="token punctuation">(</span>日志消体最小<span class="token punctuation">)</span>+KeySize+ValueSize
V1版本，一条MsgSize <span class="token operator">=</span> 12B<span class="token punctuation">(</span>日志消息头部<span class="token punctuation">)</span>+22B<span class="token punctuation">(</span>日志消体最小<span class="token punctuation">)</span>+KeySize+ValueSize
V2版本，变长字段Varints，更加节省空间，还支持更多额功能，事务、幂等性
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>1</p></li></ul></li></ul> <h2 id="八"><a href="#八" class="header-anchor">#</a> (八)</h2> <ul><li>./bin/kafka-dump-log.sh --files /Users/zhanglu/Desktop/lu/tool/dev/kafka/kafka_colony/kafka_2.11-2.2.0_0/logs/lu-learn-0/00000000000000008465.index</li></ul> <h1 id="三、参数配置"><a href="#三、参数配置" class="header-anchor">#</a> 三、参数配置</h1> <h2 id="一-服务端参数配置"><a href="#一-服务端参数配置" class="header-anchor">#</a> (一)服务端参数配置</h2> <ul><li>zookeeper.connect：指明broker要连接的zk集群地址，可以127.0.0.1:2181/kafka</li> <li>listeners
<ul><li>指明broker监听客户端连接的地址列表，多个地址逗号隔开，protocoll://hostname:port，协议类型PLAINTEXT、SSL、SASL</li> <li>不填，有可能会绑定到127.0.0.1这样无法对外提供服务，如果主机名是0.0.0.0，则表示绑定到所有的网卡</li> <li>绑定私网IP供broker间通信</li></ul></li> <li>advertised.listeners：绑定公网IP供外部客户端使用。</li> <li>broker.id：kafka集群中的标识。</li> <li>log.dir、log.dirs：配置消息以日志文件的形式持久化到磁盘，配置路径。</li> <li>enable.topic.delete：默认值true。可以删除主题。</li> <li>auto.create.topics.enable：根据消息自动创建主题，默认值true。</li> <li>auto.leader.rebalance.enable：分区自动平衡，默认值true。控制器会启动一个定时任务，轮询所有的broker节点计算每个节点的分区不平衡率(不平衡率=非优先副本的leader个数/分区总数)，是否超过leader.imbalance.per.broker.percentage参数的配置比值，默认值10%，若超过该值则会自动执行优先副本选举，执行周期由参数leader.imbalance.check.interval.seconds控制，默认值300s。</li> <li>leader.imbalance.check.interval.seconds：默认值300s。定时周期检查leader是否分布不均衡。</li> <li>max.message.bytes：<code>max.message.bytes</code>指定broker所能接收消息的最大值，默认值1000012B，约976.6KB</li> <li>replica.lag.time.max.ms：follower副本滞后的时间。只要follower每隔一段时间都可以发送FetchRequest给Leader，那个该副本不会被标记为Dead从而从ISR中移入OSR中。</li> <li>compression.type：消息压缩类型producer、uncompressed、snappy、lz4、gzip。默认值producer，表示生产者中所使用的原始压缩类型。</li> <li>leader.replication.throttled.replicas：用来配置被限制速率的主题所对应的leader副本列表。</li> <li>follower.replication.throttled.replicas：用来配置被限制速率的主题所对应的follower副本列表。</li> <li>min.insync.replicas：分区ISR集合中至少要有多少个副本。默认值1。</li> <li>unclean.leader.election.enable：是否可以从非ISR集合中选举leader副本，默认值false，若true则可能造成数据丢失。</li> <li>log.cleanup.policy：<code>cleanup.policy</code>日志压缩策略delete、compact。默认delete。</li> <li>log.cleaner.delete.retention.ms：<code>delete.retention.ms</code>被标识为删除的数据能够保留多久。默认值1天。</li> <li>log.segment.delete.delay.ms：<code>file.delete.delay.ms</code>清理文件之前可以等待多长时间。默认值1分钟。</li> <li>log.flush.interval.message：<code>flush.message</code>需要收集多少消息才会将它们强制刷新到磁盘，默认值Long.MAX_VALUE，即让操作系统来决定。</li> <li>log.flush.interval.ms：<code>flush.ms</code>需要等待多久才会将消息刷新到磁盘，默认值Long.MAX_VALUE，即让操作系统来决定。</li> <li>log.index.interval.bytes：<code>index.interval.bytes</code>用来控制添加索引项的频率。每超过这个参数设置的消息字节数时就可以添加一个新的索引项，默认值为4096。</li> <li>log.message.format.version：<code>message.format.version</code>消息格式的版本。</li> <li>log.message.timestamp.difference.max.ms：<code>message.timestamp.difference.max.ms</code>消息中自带的时间戳与broker收到消息的时间戳之间最大的差值，默认值为Long.MAX_VALUE。当log.messgae.timestamp.type=CreateTime时有效</li> <li>log.messgae.timestamp.type：<code>message.timestamp.type</code>消息的时间戳类型。默认值CreateTime。logAppendTime。</li> <li>log.cleaner.min.cleanable.ratio：<code>min.cleanable.dirty.ratio</code>日志清理时的最小污浊率。默认值0.5。</li> <li>log.cleaner.min.compaction.lag.ms：<code>min.compaction.lag.ms</code>日志在被清理前的最小保留时间，默认值0。</li> <li>log.preallocate：<code>preallocate</code>在创建日志分段的时候是否要预分配空间，默认值false。</li> <li>log.retention.bytes：<code>retention.bytes</code>分区中所能保留的消息总量，默认值-1，没有限制。</li> <li>log.retention.ms：<code>retention.ms</code>使用delete的日志清理策略时，消息能够保留的多长时间，默认值7天。若设置-1，没有期限。</li> <li>log.segment.bytes：<code>segment.bytes</code>日志分段的最大值。默认值1GB。</li> <li>log.index.sizemax.bytes：<code>segment.index.bytes</code>日志分段索引的最大值。默认值10MB。</li> <li>log.roll.jitter.ms：<code>segment.jitter.ms</code>滚动日志分段时，在segment.ms的基础之上增加的随机数，默认值0。</li> <li>log.roll.ms：<code>segment.ms</code>最长对酒滚动一次日志分段，默认值7天。</li> <li>follower.replication.throttled.rate：设置副本的复制的速度。单位B/s。</li> <li>leader.replication.throttled.rate：设置leader副本传输的速度。单位B/s。</li></ul> <h2 id="二-、客户端参数配置"><a href="#二-、客户端参数配置" class="header-anchor">#</a> (二)、客户端参数配置</h2> <h3 id="_1-生产者参数配置"><a href="#_1-生产者参数配置" class="header-anchor">#</a> 1.生产者参数配置</h3> <ul><li>bootstrap.servers</li> <li>key. serializer、value.serializer：broker端接收的消息必须以字节(byte[])的形式存在</li> <li>client.id：生产者客户端id</li> <li>buffer.memory：默认值为32MB。RecordAccumulator缓存的大小。生产者客户端缓存消息的缓冲区大小。</li> <li>max.block.ms：默认值60000。由于RecordAccumulator缓存的大小不足，send()客户端发送数据到broker时需要阻塞等待，超时则抛出异常</li> <li>batch.size：默认值16KB。byteBuffer复用的缓存，不会频繁对内存的创建和释放，实现缓存的高效利用。当一个ProducerRecord流入RecordAccumulator时，根据分区找到对应的双端队列，若ProducerBatch空则新建，若ProducerBatch内存还够则可以写入，反之新建，新建ProducerBatch时会判断该ProducerRecord的大小是否超过batch.size，若没超过则按照batch.size创建，反之，则以ProducerBatch大小来创建。以batch.size创建的内存快，可以通过BufferPool的管理来进行复用。</li> <li>消息发送数据结构过程：
<ul><li><code>&lt;分区，Deque&lt;ProducerBatch&gt;&gt;</code>：ProducerRecord-&gt;RecordAccumulator</li> <li><code>&lt;Node，List&lt;ProducerBatch&gt;&gt;</code>：Sender从RecordAccumulator中获取缓存的消息</li> <li><code>&lt;Node，Request&gt;</code>：转换成该格式，Sender线程发送至broker</li> <li><code>Map&lt;NodeId，Deque&lt;Request&gt;&gt;</code>：Sender线程发送至broker前，将请求封装成该格式(InFlightRequests)。作用，缓存已经发出去但还没有收到响应的请求</li></ul></li> <li>max.in.flight.requests.per.connection：默认值5。每个连接最多只能缓存5个未响应的请求。由于重试机制，可能无法保证消息在分区内的顺序性。例如：消息A、消息B，ack != 0，max.in.flight.requests.per.connection大于1，A发完B发，A的时候由于网络抖动发送失败了，触发重试机制，B继续发送且成功了，A重试之后发送成功，BA，消息在分区内的顺序性没有得到保障。当ack等于0，无法知晓消息成功与否，不会触发重试机制。一般建议把max.in.flight.requests.per.connection设置为1，而不是把ack配置为0。max.in.flight.requests.per.connection设置为1，只有A重试成功才会继续执行B。</li> <li>leastLoaderNode：负载最小的节点。InFlightRequests数量越少，说明请求响应速度越快，负载越小。用于做元数据请求，消费者组播协议的交互。</li> <li>asks：
<ul><li>1：默认值，只保证leader副本成功。一开始leader成功之后返回，当follower同步leader前，leader挂了，follower拉取不到leader最新的数据，就开始选举leader，数据丢失。</li> <li>0：不等待。消息写入kafka过程中出现异常。</li> <li>-1/all：等待ISR中所有副本都成功写入消息。当ISR中只有一个副本时，当leader挂了，OSR追上之后重新选举为leader后，消息丢失。</li></ul></li> <li>max.request.size：生产者客户端能发送消息的最大值。默认值1MB。</li> <li>retries：生产者重试的次数。默认值0。网络抖动、leader选举等，这些异常是可以重试。像消息太大，超过max.reqyest.size，就不会触发重试机制。</li> <li>retry.backoff.ms：默认值100。设定两次重试之间的时间间隔。需要预测异常恢复的时间，以便更精准的控制重试机制，避免过早的放弃重试。</li> <li>compression.type：消息压缩方式，默认值&quot;none&quot;。<code>gzip、snappy、lz4</code>。时间换空间。</li> <li>connections.max.idle.ms：多久之后关闭限制的连接，默认值9分钟。</li> <li>linger.ms：生产者发送ProducerBatch之前等待更多的消息。默认为0。增大该参数值会增加消息写入的延迟，但可以提升一定的吞吐量。</li> <li>receive.buffer.bytes：设置Socket接收消息缓冲区的大小。默认值32KB。-1则使用操作系统的默认值。如果Producer与Kafka处于不同机房，可适当调大该参数。</li> <li>send.buffer.bytes：设置Socket发送消息缓冲区的大小。默认值128KB。-1则使用操作系统默认值。</li> <li>request.timeout.ms：配置Producer等待请求响应的最长时间，默认值30000ms。不管ack怎么配置，请求服务端之后，等待响应的时间也有个限制。要保证request.timeout.ms大于broker配置的replica.lag.time.max.ms，以防止消息重复提交至服务端的副本上(follower还在同步Leader数据，客户端因为请求超时)。</li> <li>partitioner.class：分区器。</li> <li>interceptor.class：拦截器。</li> <li>enable.idempotence：默认值false。幂等性。</li> <li>metadata.max.age.ms：默认值5分钟。元数据更新的最长时间间隔，时间段内，元数据没更新则强制更新。</li> <li>transactional.id：默认值null。设置事务id，必须唯一。</li></ul> <h3 id="_3-消费者参数配置"><a href="#_3-消费者参数配置" class="header-anchor">#</a> 3.消费者参数配置</h3> <ul><li>bootstrap.servers</li> <li>group.id：配置消费组，默认值&quot;&quot;。</li> <li>key.deserializer、value.deserializer：kv反序列化器</li> <li>client.id：消费者客户端id</li> <li>enable.auto.commit：默认值true。自动提交，根据auto.commit.interval.ms周期提交。自动提交的操作在poll方法里面实现。
<ul><li>重复消费情况：消息处理完毕，在提交前消费者挂了，则本次消费位移没有提交，恢复后会重新读这批消息。</li> <li>消息丢失情况：消息正在处理，还未处理完成前，本次消费位移已经提交，消息处理的挂了(此时业务还没有处理完成)，恢复后不会重新读这批消息。</li> <li>手动提交依然会产生重复消费的情况：
<ul><li>消费处理逻辑完了，手动提交时，kafka挂了，偏移量没有更新到kafka上，kafka恢复，重复消费</li> <li>由于新增分区、组内消费者数量变动，触发再平衡时。再平衡期间，消费组变得不可用，若还未来得及提交偏移量就触发再平衡了，当分区重新绑定消费者时，会重复消费。</li></ul></li> <li>避免重复消费的解决方案：
<ul><li>手动提交</li> <li>每处理完一次业务，就把偏移量存入redis，再平衡后(消费者线程开始重新工作前)，监听器的回调方法里面将redis的偏移量设置kafka主题分区，从redis项目关闭前确保先停止消费者线程并把消费位移更新到redis上，项目重启，消费者线程工作前，读取redis偏移量设置kafka主题分区。</li></ul></li></ul></li> <li>auto.commit.interval.ms：默认值5s，自动提交间隔。</li> <li>auto.offset.reset：默认值&quot;latest&quot;。当找不到当前的消费位移或者位移越界时，默认从分区末尾开始消费。“earliest”从头开始消费。&quot;none&quot;不消费，抛异常。</li> <li>fetch.min.bytes：配置consumer客户端poll()能从kafka中拉取的最小数据量。默认值1B。</li> <li>fetch.max.bytes：配置consumer客户端poll()能从kafka中拉取的最大数据量。默认值50MB。若一条消息大小10B，该值1B，仍然可以正常拉取到消费。</li> <li>fetch.max.wait.ms：poll等待时间。默认值500ms。</li> <li>max.partition.fetch.bytes：配置从每个分区里返回给consumer的最大数据量。默认值1M。</li> <li>max.poll.records：一次poll，最大的消息数量。默认值500条。</li> <li>connections.max.idle.ms：指定在多久之后关闭限制的连接，默认值9分钟。</li> <li>receive.buffer.bytes：设置Socket接收消息缓冲区的大小。默认值64KB。-1则使用操作系统默认值。</li> <li>send.buffer.bytes：设置方式陪Socket发送消息缓冲区的大小，默认值128KB。-1则使用操作系统默认值。</li> <li>request.timeout.ms：设置consumer等待请求响应的最长时间。默认值30000ms。</li> <li>metadata.max.age.ms：元数据过期时间，默认值5分钟。若在该时间段内未更新则被强制更新。</li> <li>reconnect.backoff.ms：配置尝试重新连接指定主机之前的等待时间(退避时间)，默认值50ms。避免频繁连接主机。适用于消费者向broker发送的所有请求。</li> <li>retry.backoff.ms：配置尝试重新发送失败的请求到指定主题分区之前的等待时间。避免在某些故障情况下频繁地重复发送。</li> <li>isolation.level：配置消费者事务隔离级别。默认值&quot;read_uncommitted&quot;。
<ul><li>read_uncommitted：poll将返回所有消息，甚至是已中止的事务性消息，可以读到HW。</li> <li>read_committed：poll将仅返回已提交的事务性消息。最多只能返回LSO(稳定偏移量，已经提交的偏移量)的消息，比未提交的偏移量小1。</li></ul></li> <li>session.timeout.ms：默认值10000ms。组管理协议中用来检测消费者是否失效的超时时间。</li> <li>heartbeat.interval.ms：默认值3000ms。当时用分组管理功能时，心跳到消费者协调器之间的预计时间。该值必须比session.timeout.ms小，通常不高于1/3。已控制正常再平衡的预期时间。</li> <li>max.poll.interval.ms：默认值300000ms。当通过消费组管理消费者时，该配置指定拉取消息线程最长空闲时间，若超过这个时间间隔还没有发起poll操作，则消费组认为消费者已经离开，将进行再平衡操作。</li> <li>partition.aggignment.strategy：分区分配策略。</li> <li>interceptor.class：拦截器。</li></ul> <p>9 10a 11b 12c 13d 14e 15f</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">1/29/2023, 2:28:25 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/lustack.github.io/assets/js/app.66f88025.js" defer></script><script src="/lustack.github.io/assets/js/2.be206077.js" defer></script><script src="/lustack.github.io/assets/js/10.10d7d04b.js" defer></script>
  </body>
</html>
